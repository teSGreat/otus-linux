# Заметки по ДЗ-12 (резервное копирование, bacula).

ДЗ выполнялось на основе [Vagrantfile](https://github.com/haf/vagrant-bacula) из материалов к занятию. Бэкапы снимаются со сжатием, шифрованием и дедупликацией.

Я не стал делать для каждого типа резервного копирования (полное, дифференциальное,инкрементальное ) свою задачу и свое расписание. Вместо этого я добавил в задачи для каждого клиента (у меня их два) параметры, определяющие максимальное время в секундах между последней полной и дифференциальной копией.  Соответственно, преобразование уровней резервных копий будет выполнено автоматически.

```
Max Full Interval = 86400 #24 часа
```

В случае с `Max Full Interval`, если с момента полной резервной копии прошло больше суток, очередная резервная копия (не важно, дифференциальная или инкрементальная) будет преобразована в полную.

```
Max Diff Interval = 1800 #30 минут
```

Для `Max Diff Interval` всё тоже самое будет применено к дифференциальным резервным копиям.

В итоге, в задании для бэкапа каждого клиента `Level = Incremental` и в расписании все запуски выставлены в `Incremental hourly` с интервалом 10 минут.

Фактически, пришлось выставить значения немного меньшие, чем 24 часа и 30 минут, чтобы учесть время затрачиваемое на создание резервных копий.

Каталог [results](results) содержит требуемые файлы `list jobs`, `list files jobid=<id>`.

[List jobs](results/list%20jobs) приведён за всё время работы над ДЗ для того, чтобы было наглядно видно, как работает моя схема с интеллектуальной проверкой уровня резервной копии (полная или дифференциальная) с учётом внеплановых полных бэкапов без дедупликации и внеплановых полных бэкапов с дедупликацией.

Дополнительно привожу [messages](results/messages) с результатом двух последних резервных копий, где видно, что шифрование работает.